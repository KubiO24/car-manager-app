<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <title>Collective Invoices</title>
    <style>
        .bottomSection {
            width: 100%;
            display: flex;
            margin-top: 50px;
        }

        .invoicesMenu {
            width: 20%;
            margin-top: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .invoiceOption {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 80px;
        }

        .invoicesMenu div select {
            margin-bottom: 10px;
        }

        .invoiceOption div {
            display: inline;
        }

        .invoiceOption input {
            margin-bottom: 10px;
            width: 70px;
        }

        .generateInvoiceButton {
            width: 150px;
            height: 30px;
            background-color: #57d8ff;
            color: white;
            font-size: .8rem;
            user-select: none;
        }

        .tableContainer {
            width: 80%;
            padding-right: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .generateCarsButton {
            width: 250px;
            height: 40px;
            margin-bottom: 30px;
            background-color: #ff9eee;
            color: white;
            font-size: 1rem;
            user-select: none;
        }

        table img {
            width: 100px;
            margin: auto;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="navbar">
        <a href="/">Home Page</a>
        <a href="cars.html">Edit / Update Cars</a>
        <a href="admin.html">Generate Invoice</a>
        <a class="selected" href="search.html">Search Invoices</a>
    </div>

    <div class="bottomSection">
        <div class="invoicesMenu">
            <div class="invoiceOption">
                <button class="button generateInvoiceButton">Invoice for all cars</button>
            </div>

            <div class="invoiceOption">
                <select name="year" id="year">
                    <option value="2000">2000</option>
                    <option value="2010">2010</option>
                    <option value="2020">2020</option>
                </select>
                <button class="button generateInvoiceButton">Invoice for cars by year</button>
            </div>

            <div class="invoiceOption">
                <div>
                    <input type="number" id="priceFrom" min="1" max="99999">
                    -
                    <input type="number" id="priceTo" min="1" max="99999">
                </div>
                <button class="button generateInvoiceButton">Invoice for cars by price</button>
            </div>
        </div>

        <div class="tableContainer">
            <button class="button generateCarsButton" onClick="generateCars()">Generate random cars database</button>

            <table id="carTable">

            </table>
        </div>
    </div>
</div>

  <script>
        updateData = () => {
            fetch('json')
                .then((response) => response.json())
                .then((data) => {
                    if(data != "") {
                        document.querySelector("#carTable").style.width = "100%";
                    }
                    const table = document.querySelector("#carTable");
                    table.innerHTML = "";

                    for (const car of data) {
                        const row = document.createElement("tr");
                        let cell, cellText;

                        createBasicCell(car["id"], row);

                        createBasicCell(car["model"], row);

                        createBasicCell(car["year"], row);

                        cell = document.createElement("td");
                        for(const airbag of car['airbags']) {
                            cellText = document.createTextNode(`${airbag['description']}: ${airbag['value']} `);
                            cell.appendChild(cellText);
                            cell.appendChild(document.createElement("br"));
                        }
                        row.appendChild(cell);

                        cell = document.createElement("td");
                        cell.style.background = car['color'];
                        row.appendChild(cell);

                        cell = document.createElement("td");
                        const carImg = document.createElement("img");
                        carImg.src = "car brands images/" + car["model"] + ".png";
                        cell.style.padding = "0";
                        cell.appendChild(carImg);
                        row.appendChild(cell);

                        const date = car["dateOfPurchase"]["day"] + "/"  + car["dateOfPurchase"]["month"] + "/" + car["dateOfPurchase"]["year"]
                        createBasicCell(date, row);

                        createBasicCell("$" + car["price"], row);

                        createBasicCell(car["tax"] + "%", row);

                        table.appendChild(row);
                    }
                });
        }

        updateInvoices = () => {
            fetch('json')
                .then((response) => response.json())
                .then((data) => {
                    console.log(data)
                });
        }

        createBasicCell = (text, row) => {
            const cell = document.createElement("td");
            const cellText = document.createTextNode(text);
            cell.appendChild(cellText);
            row.appendChild(cell);
        }

        generateCars = async () => {
            if(await fetchGenerateCars()) {
                updateData();
            }
        }

        fetchGenerateCars = async (uuid) => {
            const options = {
                method: "POST",
            };

            let response = await fetch("/generate", options)

            if (!response.ok)
                return response.status
            else
                return await response.json() // response.json
        }

        updateData();
    </script>
</body>
</html>